## –û–±—ñ—Ü—è–Ω–∫–∞

–ö–ª–∞—Å `Promise` —ñ—Å–Ω—É—î –≤ –±–∞–≥–∞—Ç—å–æ—Ö —Å—É—á–∞—Å–Ω–∏—Ö –¥–≤–∏–≥—É–Ω–∞—Ö JavaScript —ñ –º–æ–∂–µ –±—É—Ç–∏ –ª–µ–≥–∫–æ [–ø–æ–ª—ñ—Ñ—ñ–ª–ª–µ–Ω–∏–º][polyfill]. –û—Å–Ω–æ–≤–Ω–∞ –º–æ—Ç–∏–≤–∞—Ü—ñ—è –¥–ª—è –æ–±—ñ—Ü—è–Ω–æ–∫ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –ø—Ä–∏–Ω–µ—Å—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π —Å—Ç–∏–ª—å –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫ –¥–æ –∫–æ–¥—É —Å—Ç–∏–ª—é Async / Callback.

### –ö–æ–¥ —Å—Ç–∏–ª—é Callback

–©–æ–± –ø–æ–≤–Ω—ñ—Å—Ç—é –æ—Ü—ñ–Ω–∏—Ç–∏ –æ–±—ñ—Ü—è–Ω–∫–∏, –¥–∞–≤–∞–π—Ç–µ –Ω–∞–≤–µ–¥–µ–º–æ –ø—Ä–æ—Å—Ç–∏–π –ø—Ä–∏–∫–ª–∞–¥, —è–∫–∏–π –¥–æ–≤–æ–¥–∏—Ç—å —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–∞–¥—ñ–π–Ω–æ–≥–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –∫–æ–¥—É –∑ –ø—Ä–æ—Å—Ç–∏–º–∏ –∑–≤–æ—Ä–æ—Ç–Ω–∏–º–∏ –≤–∏–∫–ª–∏–∫–∞–º–∏. –†–æ–∑–≥–ª—è–Ω—å—Ç–µ –ø—Ä–æ—Å—Ç–∏–π –≤–∏–ø–∞–¥–æ–∫ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—ó –≤–µ—Ä—Å—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è JSON –∑ —Ñ–∞–π–ª—É. –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ –≤–µ—Ä—Å—ñ—è —Ü—å–æ–≥–æ –º–æ–∂–µ –±—É—Ç–∏ –¥–æ—Å–∏—Ç—å –ø—Ä–æ—Å—Ç–æ—é:

```ts
import fs = require('fs');

function loadJSONSync(filename: string) {
    return JSON.parse(fs.readFileSync(filename));
}

// good json file
console.log(loadJSONSync('good.json'));

// non-existent file, so fs.readFileSync fails
try {
    console.log(loadJSONSync('absent.json'));
}
catch (err) {
    console.log('absent.json error', err.message);
}

// invalid json file i.e. the file exists but contains invalid JSON so JSON.parse fails
try {
    console.log(loadJSONSync('invalid.json'));
}
catch (err) {
    console.log('invalid.json error', err.message);
}
```

–Ñ —Ç—Ä–∏ –ø–æ–≤–µ–¥—ñ–Ω–∫–∏ —Ü—ñ—î—ó –ø—Ä–æ—Å—Ç–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó `loadJSONSync`: –¥—ñ–π—Å–Ω–µ –∑–Ω–∞—á–µ–Ω–Ω—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è, –ø–æ–º–∏–ª–∫–∞ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ –∞–±–æ –ø–æ–º–∏–ª–∫–∞ JSON.parse. –ú–∏ –æ–±—Ä–æ–±–ª—è—î–º–æ –ø–æ–º–∏–ª–∫–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –ø—Ä–æ—Å—Ç–æ–≥–æ try/catch, —è–∫ –≤–∏ –∑–≤–∏–∫–ª–∏ —Ä–æ–±–∏—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è –≤ —ñ–Ω—à–∏—Ö –º–æ–≤–∞—Ö –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è. –¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ —Å—Ç–≤–æ—Ä–∏–º–æ —Ö–æ—Ä–æ—à—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –≤–µ—Ä—Å—ñ—é —Ç–∞–∫–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó. –ü—Ä–∏–π–Ω—è—Ç–Ω–∏–π –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç –∑ —Ç—Ä–∏–≤—ñ–∞–ª—å–Ω–æ—é –ª–æ–≥—ñ–∫–æ—é –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –ø–æ–º–∏–ª–æ–∫ –±—É–¥–µ –Ω–∞—Å—Ç—É–ø–Ω–∏–º:

```ts
import fs = require('fs');

// –ü—Ä–∏–π–Ω—è—Ç–Ω–∏–π –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç .... –∞–ª–µ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π. –ú–∏ –ø–æ—è—Å–Ω–∏–º–æ –ø—Ä–∏—á–∏–Ω–∏ –Ω–∏–∂—á–µ
function loadJSON(filename: string, cb: (error: Error, data: any) => void) {
    fs.readFile(filename, function (err, data) {
        if (err) cb(err);
        else cb(null, JSON.parse(data));
    });
}
```

–î–æ—Å–∏—Ç—å –ø—Ä–æ—Å—Ç–æ, –≤—ñ–Ω –ø—Ä–∏–π–º–∞—î –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫, –ø–µ—Ä–µ–¥–∞—î –±—É–¥—å-—è–∫—ñ –ø–æ–º–∏–ª–∫–∏ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ –∑–≤–æ—Ä–æ—Ç–Ω–æ–º—É –≤–∏–∫–ª–∏–∫—É. –Ø–∫—â–æ –ø–æ–º–∏–ª–æ–∫ —Ñ–∞–π–ª–æ–≤–æ—ó —Å–∏—Å—Ç–µ–º–∏ –Ω–µ–º–∞—î, –≤—ñ–Ω –ø–æ–≤–µ—Ä—Ç–∞—î —Ä–µ–∑—É–ª—å—Ç–∞—Ç `JSON.parse`. –î–µ–∫—ñ–ª—å–∫–∞ –º–æ–º–µ–Ω—Ç—ñ–≤, —è–∫—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏ –ø—Ä–∏ —Ä–æ–±–æ—Ç—ñ –∑ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–º–∏ —Ñ—É–Ω–∫—Ü—ñ—è–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤—ñ –∑–≤–æ—Ä–æ—Ç–Ω–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤:

1. –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞–π—Ç–µ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ –¥–≤—ñ—á—ñ.
1. –ù—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–∏–¥–∞–π—Ç–µ –ø–æ–º–∏–ª–∫—É.

–û–¥–Ω–∞–∫ —Ü—è –ø—Ä–æ—Å—Ç–∞ —Ñ—É–Ω–∫—Ü—ñ—è –Ω–µ –≤—Ä–∞—Ö–æ–≤—É—î –¥—Ä—É–≥–∏–π –ø—É–Ω–∫—Ç. –§–∞–∫—Ç–∏—á–Ω–æ, `JSON.parse` –≤–∏–∫–∏–¥–∞—î –ø–æ–º–∏–ª–∫—É, —è–∫—â–æ –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –ø–æ–≥–∞–Ω–∏–π JSON, —ñ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è, —ñ –ø—Ä–æ–≥—Ä–∞–º–∞ –∞–≤–∞—Ä—ñ–π–Ω–æ –∑–∞–≤–µ—Ä—à—É—î—Ç—å—Å—è. –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î—Ç—å—Å—è –≤ –Ω–∏–∂—á–µ–Ω–∞–≤–µ–¥–µ–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ:

```ts
import fs = require('fs');

// –ü—Ä–∏–π–Ω—è—Ç–Ω–∏–π –ø–æ—á–∞—Ç–∫–æ–≤–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç .... –∞–ª–µ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π
function loadJSON(filename: string, cb: (error: Error, data: any) => void) {
    fs.readFile(filename, function (err, data) {
        if (err) cb(err);
        else cb(null, JSON.parse(data));
    });
}

// load invalid json
loadJSON('invalid.json', function (err, data) {
    // –¶–µ–π –∫–æ–¥ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è
    if (err) console.log('bad.json error', err.message);
    else console.log(data);
});
```

–ù–∞—ó–≤–Ω–∞ —Å–ø—Ä–æ–±–∞ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ —Ü–µ –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ–± –æ–±–≥–æ—Ä–Ω—É—Ç–∏ `JSON.parse` –≤ try catch, —è–∫ –ø–æ–∫–∞–∑–∞–Ω–æ –≤ –Ω–∏–∂—á–µ–Ω–∞–≤–µ–¥–µ–Ω–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ:

```ts
import fs = require('fs');

// –ö—Ä–∞—â–∞ —Å–ø—Ä–æ–±–∞ ... –∞–ª–µ –≤—Å–µ —â–µ –Ω–µ –ø—Ä–∞–≤–∏–ª—å–Ω–∞
function loadJSON(filename: string, cb: (error: Error) => void) {
    fs.readFile(filename, function (err, data) {
        if (err) {
            cb(err);
        }
        else {
            try {
                cb(null, JSON.parse(data));
            }
            catch (err) {
                cb(err);
            }
        }
    });
}

// load invalid json
loadJSON('invalid.json', function (err, data) {
    if (err) console.log('bad.json error', err.message);
    else console.log(data);
});
```

–û–¥–Ω–∞–∫ —É —Ü—å–æ–º—É –∫–æ–¥—ñ —î —Ö–∏—Ç—Ä–∞ –ø–æ–º–∏–ª–∫–∞. –Ø–∫—â–æ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ (`cb`), –∞ –Ω–µ `JSON.parse`, –≤–∏–∫–∏–¥–∞—î –ø–æ–º–∏–ª–∫—É, –æ—Å–∫—ñ–ª—å–∫–∏ –º–∏ –æ–±–≥–æ—Ä–Ω—É–ª–∏ –π–æ–≥–æ –≤ `try`/`catch`, –≤–∏–∫–æ–Ω—É—î—Ç—å—Å—è `catch`, —ñ –º–∏ –∑–Ω–æ–≤—É –≤–∏–∫–ª–∏–∫–∞—î–º–æ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫, —Ç–æ–±—Ç–æ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–≤—ñ—á—ñ! –¶–µ –¥–µ–º–æ–Ω—Å—Ç—Ä—É—î—Ç—å—Å—è –≤ –ø—Ä–∏–∫–ª–∞–¥—ñ –Ω–∏–∂—á–µ:

```ts
import fs = require('fs');

function loadJSON(filename: string, cb: (error: Error) => void) {
    fs.readFile(filename, function (err, data) {
        if (err) {
            cb(err);
        }
        else {
            try {
                cb(null, JSON.parse(data));
            }
            catch (err) {
                cb(err);
            }
        }
    });
}

// a good file but a bad callback ... gets called again!
loadJSON('good.json', function (err, data) {
    console.log('our callback called');

    if (err) console.log('Error:', err.message);
    else {
        // let's simulate an error by trying to access a property on an undefined variable
        var foo;
        // The following code throws `Error: Cannot read property 'bar' of undefined`
        console.log(foo.bar);
    }
});
```

```bash
$ node asyncbadcatchdemo.js
our callback called
our callback called
Error: Cannot read property 'bar' of undefined
```

–¶–µ —Ç–æ–º—É, —â–æ –Ω–∞—à–∞ —Ñ—É–Ω–∫—Ü—ñ—è `loadJSON` –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±–≥–æ—Ä–Ω—É–ª–∞ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ –≤ –±–ª–æ–∫ `try`. –¢—É—Ç —î –ø—Ä–æ—Å—Ç–∏–π —É—Ä–æ–∫, —è–∫–∏–π –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–ø–∞–º'—è—Ç–∞—Ç–∏.

> –ü—Ä–æ—Å—Ç–∏–π —É—Ä–æ–∫: –ú—ñ—Å—Ç—ñ—Ç—å —É—Å—ñ —Å–≤—ñ–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∫–æ–¥ —É –±–ª–æ–∫ try catch, –∫—Ä—ñ–º –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫.

–î–æ—Ç—Ä–∏–º—É—é—á–∏—Å—å —Ü—å–æ–≥–æ –ø—Ä–æ—Å—Ç–æ–≥–æ —É—Ä–æ–∫—É, –º–∏ –º–∞—î–º–æ –ø–æ–≤–Ω—ñ—Å—Ç—é —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –≤–µ—Ä—Å—ñ—é `loadJSON`, —è–∫–∞ –ø–æ–∫–∞–∑–∞–Ω–∞ –Ω–∏–∂—á–µ:

```ts
import fs = require('fs');

function loadJSON(filename: string, cb: (error: Error) => void) {
    fs.readFile(filename, function (err, data) {
        if (err) return cb(err);
        // –ú—ñ—Å—Ç—ñ—Ç—å —É—Å—ñ —Å–≤—ñ–π —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏–π –∫–æ–¥ —É –±–ª–æ–∫ try catch
        try {
            var parsed = JSON.parse(data);
        }
        catch (err) {
            return cb(err);
        }
        // –∫—Ä—ñ–º –≤–∏–ø–∞–¥–∫—É, –∫–æ–ª–∏ –≤–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç–µ –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫
        return cb(null, parsed);
    });
}
```
–í–∏–∑–Ω–∞—é—á–∏ —Ü–µ, –Ω–µ –≤–∞–∂–∫–æ —Å–ª—ñ–¥—É–≤–∞—Ç–∏ –∑–∞ —Ü–∏–º, —è–∫—â–æ –≤–∏ —Ü–µ –∑—Ä–æ–±–∏–ª–∏ –∫—ñ–ª—å–∫–∞ —Ä–∞–∑—ñ–≤, –∞–ª–µ, —Ç–∏–º –Ω–µ –º–µ–Ω—à, —Ü–µ –±–∞–≥–∞—Ç–æ –∫–æ–¥—É –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–Ω—è –ø—Ä–æ—Å—Ç–æ –¥–ª—è —Ö–æ—Ä–æ—à–æ—ó –æ–±—Ä–æ–±–∫–∏ –ø–æ–º–∏–ª–æ–∫. –¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ –∫—Ä–∞—â–∏–π —Å–ø–æ—Å—ñ–± –≤–∏—Ä—ñ—à–µ–Ω–Ω—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ JavaScript –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–±—ñ—Ü—è–Ω–æ–∫.

## –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±—ñ—Ü—è–Ω–∫–∏

–û–±—ñ—Ü—è–Ω–∫–∞ –º–æ–∂–µ –±—É—Ç–∏ –∞–±–æ `pending` –∞–±–æ `fulfilled` –∞–±–æ `rejected`.

![—Å—Ç–∞–Ω —Ç–∞ –¥–æ–ª—ñ –æ–±—ñ—Ü—è–Ω–æ–∫](https://raw.githubusercontent.com/basarat/typescript-book/master/images/promise%20states%20and%20fates.png)

–î–∞–≤–∞–π—Ç–µ —Ä–æ–∑–≥–ª—è–Ω–µ–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –æ–±—ñ—Ü—è–Ω–∫–∏. –¶–µ –ø—Ä–æ—Å—Ç–æ –ø–∏—Ç–∞–Ω–Ω—è –≤–∏–∫–ª–∏–∫—É `new` –Ω–∞ `Promise` (–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—ñ—Ü—è–Ω–æ–∫). –ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—ñ—Ü—è–Ω–æ–∫ –æ—Ç—Ä–∏–º—É—î —Ñ—É–Ω–∫—Ü—ñ—ó `resolve` —Ç–∞ `reject` –¥–ª—è –≤–∏—Ä—ñ—à–µ–Ω–Ω—è —Å—Ç–∞–Ω—É –æ–±—ñ—Ü—è–Ω–∫–∏:

```ts
const promise = new Promise((resolve, reject) => {
    // —Ñ—É–Ω–∫—Ü—ñ—ó resolve / reject –∫–æ–Ω—Ç—Ä–æ–ª—é—é—Ç—å –¥–æ–ª—é –æ–±—ñ—Ü—è–Ω–∫–∏
});
```

### –ü—ñ–¥–ø–∏—Å–∫–∞ –Ω–∞ –¥–æ–ª—é –æ–±—ñ—Ü—è–Ω–∫–∏

–î–æ–ª—é –æ–±—ñ—Ü—è–Ω–∫–∏ –º–æ–∂–Ω–∞ –ø—ñ–¥–ø–∏—Å–∞—Ç–∏—Å—è –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `.then` (—è–∫—â–æ –≤–æ–Ω–∞ –≤–∏—Ä—ñ—à–µ–Ω–∞) –∞–±–æ `.catch` (—è–∫—â–æ –≤–æ–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–∞).

```ts
const promise = new Promise((resolve, reject) => {
    resolve(123);
});
promise.then((res) => {
    console.log('–Ø –≤–∏–∫–ª–∏–∫–∞—é—Å—è:', res === 123); // –Ø –≤–∏–∫–ª–∏–∫–∞—é—Å—è: true
});
promise.catch((err) => {
    // –¶–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
});
```

```ts
const promise = new Promise((resolve, reject) => {
    reject(new Error("–©–æ—Å—å —Å—Ç–∞–ª–æ—Å—è"));
});
promise.then((res) => {
    // –¶–µ –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
});
promise.catch((err) => {
    console.log('–Ø –≤–∏–∫–ª–∏–∫–∞—é—Å—è:', err.message); // –Ø –≤–∏–∫–ª–∏–∫–∞—é—Å—è: '–©–æ—Å—å —Å—Ç–∞–ª–æ—Å—è'
});
```

> –ü–û–†–ê–î–ê: –®–≤–∏–¥–∫—ñ –æ–±—ñ—Ü—è–Ω–∫–∏
* –®–≤–∏–¥–∫–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∂–µ –≤–∏—Ä—ñ—à–µ–Ω–æ—ó –æ–±—ñ—Ü—è–Ω–∫–∏: `Promise.resolve(result)`
* –®–≤–∏–¥–∫–µ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∂–µ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ—ó –æ–±—ñ—Ü—è–Ω–∫–∏: `Promise.reject(error)`

### –õ–∞–Ω—Ü—é–∂–∫–æ–≤—ñ—Å—Ç—å –æ–±—ñ—Ü—è–Ω–æ–∫
–õ–∞–Ω—Ü—é–∂–∫–æ–≤—ñ—Å—Ç—å –æ–±—ñ—Ü—è–Ω–æ–∫ **—î —Å–µ—Ä—Ü–µ–º –ø–µ—Ä–µ–≤–∞–≥, —è–∫—ñ –Ω–∞–¥–∞—é—Ç—å –æ–±—ñ—Ü—è–Ω–∫–∏**. –Ø–∫ —Ç—ñ–ª—å–∫–∏ —É –≤–∞—Å —î –æ–±—ñ—Ü—è–Ω–∫–∞, –∑ —Ü—å–æ–≥–æ –º–æ–º–µ–Ω—Ç—É –≤–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é `then`, —â–æ–± —Å—Ç–≤–æ—Ä–∏—Ç–∏ –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–±—ñ—Ü—è–Ω–æ–∫.

* –Ø–∫—â–æ –≤–∏ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç–µ –æ–±—ñ—Ü—è–Ω–∫—É –∑ –±—É–¥—å-—è–∫–æ—ó —Ñ—É–Ω–∫—Ü—ñ—ó –≤ –ª–∞–Ω—Ü—é–∂–∫—É, `.then` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –ª–∏—à–µ –ø—ñ—Å–ª—è —Ç–æ–≥–æ, —è–∫ –∑–Ω–∞—á–µ–Ω–Ω—è –≤–∏—Ä—ñ—à–µ–Ω–æ:

```ts
Promise.resolve(123)
    .then((res) => {
        console.log(res); // 123
        return 456;
    })
    .then((res) => {
        console.log(res); // 456
        return Promise.resolve(123); // –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –º–∏ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ –æ–±—ñ—Ü—è–Ω–∫—É
    })
    .then((res) => {
        console.log(res); // 123 : –ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ —Ü–µ–π `then` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –∑ –≤–∏—Ä—ñ—à–µ–Ω–∏–º –∑–Ω–∞—á–µ–Ω–Ω—è–º
        return 123;
    })
```

* –í–∏ –º–æ–∂–µ—Ç–µ –∞–≥—Ä–µ–≥—É–≤–∞—Ç–∏ –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫ –±—É–¥—å-—è–∫–æ—ó –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ—ó —á–∞—Å—Ç–∏–Ω–∏ –ª–∞–Ω—Ü—é–∂–∫–∞ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é –æ–¥–Ω–æ–≥–æ `catch`:

```ts
// –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–∏–π –æ–±—ñ—Ü—è–Ω–∫—É
Promise.reject(new Error('—â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫'))
    .then((res) => {
        console.log(res); // –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
        return 456;
    })
    .then((res) => {
        console.log(res); // –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
        return 123;
    })
    .then((res) => {
        console.log(res); // –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
        return 123;
    })
    .catch((err) => {
        console.log(err.message); // —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫
    });
```

* `catch` —Ñ–∞–∫—Ç–∏—á–Ω–æ –ø–æ–≤–µ—Ä—Ç–∞—î –Ω–æ–≤—É –æ–±—ñ—Ü—è–Ω–∫—É (–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ —Å—Ç–≤–æ—Ä—é—é—á–∏ –Ω–æ–≤–∏–π –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–±—ñ—Ü—è–Ω–æ–∫):

```ts
// –°—Ç–≤–æ—Ä–∏—Ç–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–∏–π –æ–±—ñ—Ü—è–Ω–∫—É
Promise.reject(new Error('—â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫'))
    .then((res) => {
        console.log(res); // –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
        return 456;
    })
    .catch((err) => {
        console.log(err.message); // —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫
        return 123;
    })
    .then((res) => {
        console.log(res); // 123
    })
```

* –ë—É–¥—å-—è–∫—ñ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏, —â–æ –≤–∏–Ω–∏–∫–∞—é—Ç—å —É `then` (–∞–±–æ `catch`), –ø—Ä–∏–∑–≤–æ–¥—è—Ç—å –¥–æ –Ω–µ–≤–¥–∞—á—ñ –ø–æ–≤–µ—Ä–Ω–µ–Ω–æ—ó –æ–±—ñ—Ü—è–Ω–∫–∏:

```ts
Promise.resolve(123)
    .then((res) => {
        throw new Error('—â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫'); // –≤–∏–∫–∏–Ω—É—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –ø–æ–º–∏–ª–∫—É
        return 456;
    })
    .then((res) => {
        console.log(res); // –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
        return Promise.resolve(789);
    })
    .catch((err) => {
        console.log(err.message); // —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫
    })
```

* –¢—ñ–ª—å–∫–∏ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–∏–π (–Ω–∞–π–±–ª–∏–∂—á–∏–π —Ö–≤–æ—Å—Ç–æ–≤–∏–π) `catch` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –¥–ª—è –¥–∞–Ω–æ—ó –ø–æ–º–∏–ª–∫–∏ (—Ç–∞–∫ —è–∫ catch –ø–æ—á–∏–Ω–∞—î –Ω–æ–≤–∏–π –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–±—ñ—Ü—è–Ω–æ–∫).

```ts
Promise.resolve(123)
    .then((res) => {
        throw new Error('—â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫'); // –≤–∏–∫–∏–Ω—É—Ç–∏ —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –ø–æ–º–∏–ª–∫—É
        return 456;
    })
    .catch((err) => {
        console.log('–ø–µ—Ä—à–∏–π catch: ' + err.message); // —â–æ—Å—å –ø—ñ—à–ª–æ –Ω–µ —Ç–∞–∫
        return 123;
    })
    .then((res) => {
        console.log(res); // 123
        return Promise.resolve(789);
    })
    .catch((err) => {
        console.log('–¥—Ä—É–≥–∏–π catch: ' + err.message); // –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
    })
```

* `catch` –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –≤ —Ä–∞–∑—ñ –ø–æ–º–∏–ª–∫–∏ –≤ –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –ª–∞–Ω—Ü—é–∂–∫—É:

```ts
Promise.resolve(123)
    .then((res) => {
        return 456;
    })
    .catch((err) => {
        console.log("–¢–£–¢"); // –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
    })
```

–¢–æ–π —Ñ–∞–∫—Ç, —â–æ:

* –ø–æ–º–∏–ª–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥—è—Ç—å –¥–æ —Ö–≤–æ—Å—Ç–æ–≤–æ–≥–æ `catch` (—ñ –ø—Ä–æ–ø—É—Å–∫–∞—é—Ç—å –±—É–¥—å-—è–∫—ñ –ø—Ä–æ–º—ñ–∂–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ `then`) —ñ
* —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –ø–æ–º–∏–ª–∫–∏ —Ç–∞–∫–æ–∂ –ª–æ–≤–ª—è—Ç—å—Å—è –±—É–¥—å-—è–∫–∏–º —Ö–≤–æ—Å—Ç–æ–≤–∏–º `catch`.

–µ—Ñ–µ–∫—Ç–∏–≤–Ω–æ –Ω–∞–¥–∞—î –Ω–∞–º –ø–∞—Ä–∞–¥–∏–≥–º—É –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø—Ä–æ–≥—Ä–∞–º—É–≤–∞–Ω–Ω—è, —è–∫–∞ –¥–æ–∑–≤–æ–ª—è—î –∫—Ä–∞—â—É –æ–±—Ä–æ–±–∫—É –ø–æ–º–∏–ª–æ–∫, –Ω—ñ–∂ –ø—Ä–æ—Å—Ç—ñ –∑–≤–æ—Ä–æ—Ç–Ω—ñ –≤–∏–∫–ª–∏–∫–∏. –î–æ–∫–ª–∞–¥–Ω—ñ—à–µ –ø—Ä–æ —Ü–µ –Ω–∏–∂—á–µ.


### TypeScript —Ç–∞ –æ–±—ñ—Ü—è–Ω–∫–∏
–ß—É–¥–æ–≤–æ—é —Ä—ñ—á—á—é –ø—Ä–æ TypeScript —î —Ç–µ, —â–æ –≤—ñ–Ω —Ä–æ–∑—É–º—ñ—î –ø–æ—Ç—ñ–∫ –∑–Ω–∞—á–µ–Ω—å —á–µ—Ä–µ–∑ –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–±—ñ—Ü—è–Ω–æ–∫:

```ts
Promise.resolve(123)
    .then((res) => {
         // res –º–∞—î —Ç–∏–ø `number`
         return true;
    })
    .then((res) => {
        // res –º–∞—î —Ç–∏–ø `boolean`

    });
```

–ó–≤–∏—á–∞–π–Ω–æ, –≤—ñ–Ω —Ç–∞–∫–æ–∂ —Ä–æ–∑—É–º—ñ—î —Ä–æ–∑–≥–æ—Ä—Ç–∞–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –≤–∏–∫–ª–∏–∫—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ–π, —è–∫—ñ –º–æ–∂—É—Ç—å –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ –æ–±—ñ—Ü—è–Ω–∫—É:

```ts
function iReturnPromiseAfter1Second(): Promise<string> {
    return new Promise((resolve) => {
        setTimeout(() => resolve("–ü—Ä–∏–≤—ñ—Ç —Å–≤—ñ—Ç!"), 1000);
    });
}

Promise.resolve(123)
    .then((res) => {
        // res –º–∞—î —Ç–∏–ø `number`
        return iReturnPromiseAfter1Second(); // –ú–∏ –ø–æ–≤–µ—Ä—Ç–∞—î–º–æ `Promise<string>`
    })
    .then((res) => {
        // res –º–∞—î —Ç–∏–ø `string`
        console.log(res); // –ü—Ä–∏–≤—ñ—Ç —Å–≤—ñ—Ç!
    });
```


### –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞–Ω–Ω—è —Ñ—É–Ω–∫—Ü—ñ—ó —É —Å—Ç–∏–ª—ñ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É –¥–ª—è –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –æ–±—ñ—Ü—è–Ω–∫–∏

–ü—Ä–æ—Å—Ç–æ –æ–±–µ—Ä–Ω—ñ—Ç—å –≤–∏–∫–ª–∏–∫ —Ñ—É–Ω–∫—Ü—ñ—ó –≤ –æ–±—ñ—Ü—è–Ω–∫—É —Ç–∞
- `reject`, —è–∫—â–æ –≤–∏–Ω–∏–∫–∞—î –ø–æ–º–∏–ª–∫–∞,
- `resolve`, —è–∫—â–æ –≤—Å–µ –¥–æ–±—Ä–µ.

–ù–∞–ø—Ä–∏–∫–ª–∞–¥, –¥–∞–≤–∞–π—Ç–µ –æ–±–µ—Ä–Ω–µ–º–æ `fs.readFile`:

```ts
import fs = require('fs');
function readFileAsync(filename: string): Promise<any> {
    return new Promise((resolve,reject) => {
        fs.readFile(filename,(err,result) => {
            if (err) reject(err);
            else resolve(result);
        });
    });
}
```

–ù–∞–π–±—ñ–ª—å—à –Ω–∞–¥—ñ–π–Ω–∏–º —Å–ø–æ—Å–æ–±–æ–º —î –Ω–∞–ø–∏—Å–∞–Ω–Ω—è —Ü—å–æ–≥–æ –≤–ª–∞—Å–Ω–æ—Ä—É—á, —ñ —Ü–µ –Ω–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ–≤–∏–Ω–Ω–æ –±—É—Ç–∏ —Ç–∞–∫–∏–º –∂–µ –¥–µ—Ç–∞–ª—å–Ω–∏–º, —è–∫ —É –ø–æ–ø–µ—Ä–µ–¥–Ω—å–æ–º—É –ø—Ä–∏–∫–ª–∞–¥—ñ, –Ω–∞–ø—Ä–∏–∫–ª–∞–¥, –ø–µ—Ä–µ—Ç–≤–æ—Ä–µ–Ω–Ω—è `setTimeout` –≤ —Ñ—É–Ω–∫—Ü—ñ—é `delay`, —è–∫–∞ –ø–æ–≤–µ—Ä—Ç–∞—î –æ–±—ñ—Ü—è–Ω–∫—É, —î –¥—É–∂–µ –ø—Ä–æ—Å—Ç–∏–º:

```ts
const delay = (ms: number) => new Promise(res => setTimeout(res, ms));
```

–ó–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, —â–æ –≤ NodeJS —î –∑—Ä—É—á–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è, —è–∫–∞ —Ä–æ–±–∏—Ç—å —Ü–µ –º–∞–≥—ñ—é –∑ —Ñ—É–Ω–∫—Ü—ñ—î—é –≤ —Å—Ç–∏–ª—ñ `node => promise` –∑–∞ –≤–∞—Å:

```ts
/** –ü—Ä–∏–∫–ª–∞–¥ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è */
import fs from 'fs';
import util from 'util';
const readFile = util.promisify(fs.readFile);
```

> Webpack –ø—ñ–¥—Ç—Ä–∏–º—É—î –º–æ–¥—É–ª—å `util` –∑ –∫–æ—Ä–æ–±–∫–∏, —ñ –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ –π–æ–≥–æ —Ç–∞–∫–æ–∂ —É –±—Ä–∞—É–∑–µ—Ä—ñ.

–Ø–∫—â–æ —É –≤–∞—Å —î —Ñ—É–Ω–∫—Ü—ñ—è —É —Å—Ç–∏–ª—ñ –∑–≤–æ—Ä–æ—Ç–Ω–æ–≥–æ –≤–∏–∫–ª–∏–∫—É Node —è–∫ *—á–ª–µ–Ω*, –ø–µ—Ä–µ–∫–æ–Ω–∞–π—Ç–µ—Å—è, —â–æ –≤–∏ —Ç–∞–∫–æ–∂ `bind` –π–æ–≥–æ, —â–æ–± –≤–ø–µ–≤–Ω–∏—Ç–∏—Å—è, —â–æ –≤—ñ–Ω –º–∞—î –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π `this`:

```ts
const dbGet = util.promisify(db.get).bind(db);
```

### –ü–µ—Ä–µ–≥–ª—è–¥ –ø—Ä–∏–∫–ª–∞–¥—É JSON

–¢–µ–ø–µ—Ä –¥–∞–≤–∞–π—Ç–µ –ø–µ—Ä–µ–≥–ª—è–Ω–µ–º–æ –Ω–∞—à –ø—Ä–∏–∫–ª–∞–¥ `loadJSON` —Ç–∞ –ø–µ—Ä–µ–ø–∏—à–µ–º–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—É –≤–µ—Ä—Å—ñ—é, —è–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –æ–±—ñ—Ü—è–Ω–∫–∏. –í—Å–µ, —â–æ –Ω–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑—Ä–æ–±–∏—Ç–∏, —Ü–µ –ø—Ä–æ—á–∏—Ç–∞—Ç–∏ –≤–º—ñ—Å—Ç —Ñ–∞–π–ª—É —è–∫ –æ–±—ñ—Ü—è–Ω–∫—É, –ø–æ—Ç—ñ–º —Ä–æ–∑—ñ–±—Ä–∞—Ç–∏ –π–æ–≥–æ —è–∫ JSON, —ñ –º–∏ –≥–æ—Ç–æ–≤—ñ. –¶–µ –ø—Ä–æ—ñ–ª—é—Å—Ç—Ä–æ–≤–∞–Ω–æ –≤ –Ω–∞–≤–µ–¥–µ–Ω–æ–º—É –Ω–∏–∂—á–µ –ø—Ä–∏–∫–ª–∞–¥—ñ:

```ts
function loadJSONAsync(filename: string): Promise<any> {
    return readFileAsync(filename) // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ —Ñ—É–Ω–∫—Ü—ñ—é, —è–∫—É –º–∏ —â–æ–π–Ω–æ –Ω–∞–ø–∏—Å–∞–ª–∏
                .then(function (res) {
                    return JSON.parse(res);
                });
}
```

–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è (–∑–≤–µ—Ä–Ω—ñ—Ç—å —É–≤–∞–≥—É, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ –≤–æ–Ω–æ —Å—Ö–æ–∂–µ –Ω–∞ –ø–æ—á–∞—Ç–∫–æ–≤—É `sync` –≤–µ—Ä—Å—ñ—é, –≤–≤–µ–¥–µ–Ω—É –Ω–∞ –ø–æ—á–∞—Ç–∫—É —Ü—å–æ–≥–æ —Ä–æ–∑–¥—ñ–ª—É üåπ):

```ts
// good json file
loadJSONAsync('good.json')
    .then(function (val) { console.log(val); })
    .catch(function (err) {
        console.log('good.json error', err.message); // –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
    })

// non-existent json file
    .then(function () {
        return loadJSONAsync('absent.json');
    })
    .then(function (val) { console.log(val); }) // –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
    .catch(function (err) {
        console.log('absent.json error', err.message);
    })

// invalid json file
    .then(function () {
        return loadJSONAsync('invalid.json');
    })
    .then(function (val) { console.log(val); }) // –Ω—ñ–∫–æ–ª–∏ –Ω–µ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è
    .catch(function (err) {
        console.log('bad.json error', err.message);
    });
```

–ü—Ä–∏—á–∏–Ω–∞, —á–æ–º—É —Ü—è —Ñ—É–Ω–∫—Ü—ñ—è –±—É–ª–∞ –ø—Ä–æ—Å—Ç—ñ—à–æ—é, –ø–æ–ª—è–≥–∞—î –≤ —Ç–æ–º—É, —â–æ –æ–±'—î–¥–Ω–∞–Ω–Ω—è "`loadFile`(async) + `JSON.parse` (sync) => `catch`" –±—É–ª–æ –∑—Ä–æ–±–ª–µ–Ω–æ –ª–∞–Ω—Ü—é–∂–∫–æ–º –æ–±—ñ—Ü—è–Ω–æ–∫. –ö—Ä—ñ–º —Ç–æ–≥–æ, –∑–≤–æ—Ä–æ—Ç–Ω–∏–π –≤–∏–∫–ª–∏–∫ –Ω–µ –±—É–≤ –≤–∏–∫–ª–∏–∫–∞–Ω–∏–π *–Ω–∞–º–∏*, –∞ –≤–∏–∫–ª–∏–∫–∞–≤ –π–æ–≥–æ –ª–∞–Ω—Ü—é–∂–æ–∫ –æ–±—ñ—Ü—è–Ω–æ–∫, —Ç–æ–º—É –º–∏ –Ω–µ –º–∞–ª–∏ –º–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –∑—Ä–æ–±–∏—Ç–∏ –ø–æ–º–∏–ª–∫—É, –æ–±–≥–æ—Ä–Ω—É–≤—à–∏ –π–æ–≥–æ –≤ `try/catch`.

### –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π –ø–æ—Ç—ñ–∫ —É–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è
–ú–∏ –ø–æ–±–∞—á–∏–ª–∏, –Ω–∞—Å–∫—ñ–ª—å–∫–∏ —Ç—Ä–∏–≤—ñ–∞–ª—å–Ω–∏–º —î –≤–∏–∫–æ–Ω–∞–Ω–Ω—è –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—ó –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ—Å—Ç—ñ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∑–∞–¥–∞—á –∑ –æ–±—ñ—Ü—è–Ω–∫–∞–º–∏. –¶–µ –ø—Ä–æ—Å—Ç–æ –ø–∏—Ç–∞–Ω–Ω—è –ª–∞–Ω—Ü—é–∂–∫–∞ –≤–∏–∫–ª–∏–∫—ñ–≤ `then`.

–û–¥–Ω–∞–∫ –≤–∏, –º–æ–∂–ª–∏–≤–æ, –∑–∞—Ö–æ—á–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä—ñ—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∑–∞–¥–∞—á, –∞ –ø–æ—Ç—ñ–º —â–æ—Å—å –∑—Ä–æ–±–∏—Ç–∏ –∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ –≤—Å—ñ—Ö —Ü–∏—Ö –∑–∞–¥–∞—á. `Promise` –Ω–∞–¥–∞—î —Å—Ç–∞—Ç–∏—á–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é `Promise.all`, —è–∫—É –≤–∏ –º–æ–∂–µ—Ç–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, —â–æ–± —á–µ–∫–∞—Ç–∏ –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è `n` –∫—ñ–ª—å–∫–æ—Å—Ç—ñ –æ–±—ñ—Ü—è–Ω–æ–∫. –í–∏ –Ω–∞–¥–∞—î—Ç–µ –π–æ–º—É –º–∞—Å–∏–≤ –∑ `n` –æ–±—ñ—Ü—è–Ω–∫–∞–º–∏, —ñ –≤—ñ–Ω –¥–∞—î –≤–∞–º –º–∞—Å–∏–≤ –∑ `n` —Ä–æ–∑–≤'—è–∑–∞–Ω–∏–º–∏ –∑–Ω–∞—á–µ–Ω–Ω—è–º–∏. –ù–∏–∂—á–µ –º–∏ –ø–æ–∫–∞–∑—É—î–º–æ –õ–∞–Ω—Ü—é–∂–æ–∫, –∞ —Ç–∞–∫–æ–∂ –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π:

```ts
// –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è —ñ–º—ñ—Ç–∞—Ü—ñ—ó –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç–∞ –∑ —è–∫–æ–≥–æ—Å—å —Å–µ—Ä–≤–µ—Ä–∞
function loadItem(id: number): Promise<{ id: number }> {
    return new Promise((resolve) => {
        console.log('loading item', id);
        setTimeout(() => { // —ñ–º—ñ—Ç—É—î –∑–∞—Ç—Ä–∏–º–∫—É —Å–µ—Ä–≤–µ—Ä–∞
            resolve({ id: id });
        }, 1000);
    });
}

// –õ–∞–Ω—Ü—é–∂–∫–æ–≤–∏–π / –ü–æ—Å–ª—ñ–¥–æ–≤–Ω–∏–π
let item1, item2;
loadItem(1)
    .then((res) => {
        item1 = res;
        return loadItem(2);
    })
    .then((res) => {
        item2 = res;
        console.log('done');
    }); // –∑–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –±—É–¥–µ –±–ª–∏–∑—å–∫–æ 2 —Å

// –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∏–π / –ü–∞—Ä–∞–ª–µ–ª—å–Ω–∏–π
Promise.all([loadItem(1), loadItem(2)])
    .then((res) => {
        [item1, item2] = res;
        console.log('done');
    }); // –∑–∞–≥–∞–ª—å–Ω–∏–π —á–∞—Å –±—É–¥–µ –±–ª–∏–∑—å–∫–æ 1 —Å
```

–Ü–Ω–æ–¥—ñ –≤–∏ —Ö–æ—á–µ—Ç–µ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ —Å–µ—Ä—ñ—é –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∏—Ö –∑–∞–¥–∞—á, –∞–ª–µ –≤–∏ –æ—Ç—Ä–∏–º—É—î—Ç–µ –≤—Å–µ, —â–æ –≤–∞–º –ø–æ—Ç—Ä—ñ–±–Ω–æ, —è–∫ —Ç—ñ–ª—å–∫–∏ –±—É–¥—å-—è–∫–∞ –∑ —Ü–∏—Ö –∑–∞–¥–∞—á –≤–∏—Ä—ñ—à–µ–Ω–∞. `Promise` –Ω–∞–¥–∞—î —Å—Ç–∞—Ç–∏—á–Ω—É —Ñ—É–Ω–∫—Ü—ñ—é `Promise.race` –¥–ª—è —Ü—å–æ–≥–æ —Å—Ü–µ–Ω–∞—Ä—ñ—é:

```ts
var task1 = new Promise(function(resolve, reject) {
    setTimeout(resolve, 1000, 'one');
});
var task2 = new Promise(function(resolve, reject) {
    setTimeout(resolve, 2000, 'two');
});

Promise.race([task1, task2]).then(function(value) {
  console.log(value); // "one"
  // –û–±–∏–¥–≤–∞ —Ä–æ–∑–≤'—è–∑—É—é—Ç—å—Å—è, –∞–ª–µ task1 —Ä–æ–∑–≤'—è–∑—É—î—Ç—å—Å—è —à–≤–∏–¥—à–µ
});
```

[–ø–æ–ª—ñ—Ñ—ñ–ª]:https://github.com/stefanpenner/es6-promise